// Fabric module - Fabric-specific implementations and entry points
// Contains Fabric platform implementations and mod loading

plugins {
    id 'fabric-loom' version '1.5-SNAPSHOT'
    id 'java'
}

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

loom {
    // Ensure proper source remapping
    runs {
        client {
            client()
            setConfigName("Fabric Client")
            source sourceSets.main
        }
        server {
            server()
            setConfigName("Fabric Server")  
            source sourceSets.main
        }
    }
}

archivesBaseName = 'businesscraft-fabric'

dependencies {
    minecraft 'com.mojang:minecraft:1.20.1'
    mappings 'net.fabricmc:yarn:1.20.1+build.10:v2'
    modImplementation 'net.fabricmc:fabric-loader:0.15.11'
    modImplementation 'net.fabricmc.fabric-api:fabric-api:0.92.2+1.20.1'
    
    // Include common module
    implementation project(':common')
    
    // Enhanced MultiLoader approach: Zero external dependencies
    // No Architectury or third-party APIs - direct platform API usage only
}

processResources {
    inputs.property "version", project.version
    
    filesMatching("fabric.mod.json") {
        expand "version": project.version
    }
}

jar {
    manifest {
        attributes([
            "Specification-Title": "businesscraft-fabric",
            "Specification-Vendor": "Quackers29",
            "Specification-Version": "1",
            "Implementation-Title": "BusinessCraft Fabric", 
            "Implementation-Version": project.version,
            "Implementation-Vendor": "Quackers29",
            "Implementation-Timestamp": new Date().format("yyyy-MM-dd'T'HH:mm:ssZ")
        ])
    }
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    
    // Include common module resources
    from project(':common').sourceSets.main.resources  
    from sourceSets.main.resources
}